---
const testimonials = [
  {
    id: 1,
    content: "Ehsan delivered our e-commerce platform with exceptional attention to detail. The site's performance metrics improved by 35% and our conversion rate jumped significantly. His expertise in modern web development was exactly what we needed.",
    name: "Sarah Johnson",
    role: "CTO, TechRetail",
    image: "https://images.unsplash.com/photo-1494790108377-be9c29b29330?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=150&q=80",
  },
  {
    id: 2,
    content: "Working with Ehsan was a game-changer for our startup. He built our entire web application from scratch, implementing complex features like real-time data visualization and authentication that worked flawlessly. His problem-solving skills saved us countless hours.",
    name: "Michael Chen",
    role: "Founder, DataSync",
    image: "https://images.unsplash.com/photo-1507003211169-0a1dd7228f2d?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=150&q=80",
  },
  {
    id: 3,
    content: "I was impressed by Ehsan's ability to translate our design concepts into functional, responsive websites. His knowledge of modern CSS and animation techniques brought our brand to life online, and the custom CMS he built makes updates incredibly easy.",
    name: "Priya Patel",
    role: "Marketing Director, CreativeWorks",
    image: "https://images.unsplash.com/photo-1573496359142-b8d87734a5a2?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=150&q=80",
  },
];
---

<section class="py-20 px-4 relative overflow-hidden" id="testimonials">
  <!-- Background Elements -->
  <div class="absolute inset-0 -z-10">
    <div class="hero-ring w-[800px] h-[800px] opacity-20"></div>
    <div class="hero-ring w-[600px] h-[600px] opacity-15"></div>
  </div>

  <div class="max-w-6xl mx-auto">
    <h2 class="text-4xl md:text-5xl font-doto font-bold mb-4 text-center">
      <span class="text-[oklch(var(--accent-title))]">Client</span> Testimonials
    </h2>
    <p class="text-foreground-muted text-center max-w-2xl mx-auto mb-16">Don't just take my word for it - here's what clients have to say about working with me.</p>

    <div class="testimonial-container relative">
      <!-- Left Navigation Arrow -->
      <button class="testimonial-nav-arrow testimonial-nav-prev" aria-label="Previous testimonial">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-6 h-6">
          <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 19.5L8.25 12l7.5-7.5"></path>
        </svg>
      </button>

      <!-- Right Navigation Arrow -->
      <button class="testimonial-nav-arrow testimonial-nav-next" aria-label="Next testimonial">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-6 h-6">
          <path stroke-linecap="round" stroke-linejoin="round" d="M8.25 4.5l7.5 7.5-7.5 7.5"></path>
        </svg>
      </button>

      <div class="testimonial-carousel relative min-h-[370px]">
        {
          testimonials.map((testimonial, index) => (
            <div class={`testimonial-item absolute w-full ${index === 0 ? "active" : ""}`} data-index={index}>
              <div class="testimonial-card">
                <div class="quote-marks">
                  <svg class="text-[oklch(var(--accent-text))] w-12 h-12 mb-6 opacity-80" fill="currentColor" viewBox="0 0 24 24">
                    <path d="M14.017 21v-7.391c0-5.704 3.731-9.57 8.983-10.609l.995 2.151c-2.432.917-3.995 3.638-3.995 5.849h4v10h-9.983zm-14.017 0v-7.391c0-5.704 3.748-9.57 9-10.609l.996 2.151c-2.433.917-3.996 3.638-3.996 5.849h3.983v10h-9.983z" />
                  </svg>
                </div>

                <p class="testimonial-content text-justify">{testimonial.content}</p>

                <div class="testimonial-author">
                  <div class="testimonial-avatar">
                    <img src={testimonial.image} alt={testimonial.name} />
                  </div>
                  <div class="testimonial-info">
                    <h4 class="testimonial-name">{testimonial.name}</h4>
                    <p class="testimonial-role">{testimonial.role}</p>
                  </div>
                </div>
              </div>
            </div>
          ))
        }
      </div>

      <!-- Navigation Dots -->
      <div class="testimonial-navigation flex justify-center mt-8 space-x-2">
        {testimonials.map((_, index) => <button class={`testimonial-dot transition-all duration-300 ${index === 0 ? "active" : ""}`} data-index={index} aria-label={`View testimonial ${index + 1}`} />)}
      </div>
    </div>
  </div>
</section>

<style>
  .testimonial-container {
    position: relative;
    padding: 0 1.5rem;
  }

  .testimonial-carousel {
    position: relative;
    margin-bottom: 3rem;
  }

  .testimonial-item {
    opacity: 0;
    transform: translateY(20px);
    transition:
      opacity 0.5s ease,
      transform 0.5s ease;
    width: 100%;
    position: relative;
    left: 0;
    top: 0;
    display: none;
  }

  .testimonial-item.active {
    opacity: 1;
    transform: translateY(0);
    visibility: visible;
    display: block;
  }

  .testimonial-card {
    background: linear-gradient(135deg, oklch(var(--accent-bg) / 0.08), oklch(var(--accent-bg) / 0.03));
    backdrop-filter: blur(10px);
    border: 1px solid oklch(var(--accent-bg) / 0.15);
    border-radius: 1rem;
    padding: 2rem;
    box-shadow:
      0 10px 20px -5px oklch(var(--accent-bg) / 0.2),
      inset 0 1px 1px oklch(var(--accent-text) / 0.05);
    height: 100%;
    display: flex;
    flex-direction: column;
    position: relative;
    overflow: hidden;
  }

  .testimonial-card::before {
    content: "";
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 4px;
    background: linear-gradient(90deg, oklch(var(--accent-text) / 0.7), oklch(var(--accent-title)));
    border-radius: 4px 4px 0 0;
  }

  .quote-marks {
    margin-bottom: 0.5rem;
  }

  .testimonial-content {
    color: var(--color-foreground);
    font-size: 1.125rem;
    line-height: 1.7;
    margin-bottom: 2rem;
    flex-grow: 1;
    position: relative;
  }

  .testimonial-author {
    display: flex;
    align-items: center;
    border-top: 1px solid oklch(var(--accent-bg) / 0.15);
    padding-top: 1.25rem;
    margin-top: auto;
  }

  .testimonial-avatar {
    width: 3.5rem;
    height: 3.5rem;
    border-radius: 9999px;
    overflow: hidden;
    margin-right: 1rem;
    border: 2px solid oklch(var(--accent-text) / 0.3);
    background: linear-gradient(145deg, oklch(var(--accent-bg) / 0.2), transparent);
    box-shadow: 0 2px 10px -2px oklch(var(--accent-bg) / 0.4);
  }

  .testimonial-avatar img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform 0.3s ease;
  }

  .testimonial-item.active .testimonial-avatar img {
    transform: scale(1.05);
  }

  .testimonial-info {
    display: flex;
    flex-direction: column;
  }

  .testimonial-name {
    font-weight: 700;
    font-size: 1.125rem;
    color: var(--color-foreground);
  }

  .testimonial-role {
    color: var(--color-foreground-muted);
    font-size: 0.9rem;
  }

  .testimonial-dot {
    width: 0.75rem;
    height: 0.75rem;
    border-radius: 9999px;
    background-color: oklch(var(--accent-text) / 0.3);
    cursor: pointer;
    transition: all 0.3s ease;
  }

  .testimonial-dot.active {
    width: 2rem;
    background-color: oklch(var(--accent-text));
  }

  .testimonial-dot:hover:not(.active) {
    background-color: oklch(var(--accent-text) / 0.5);
  }

  .testimonial-nav-arrow {
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    z-index: 10;
    width: 3rem;
    height: 3rem;
    display: flex;
    align-items: center;
    justify-content: center;
    background: oklch(var(--accent-bg) / 0.1);
    color: oklch(var(--accent-text));
    border-radius: 50%;
    backdrop-filter: blur(8px);
    border: 1px solid oklch(var(--accent-text) / 0.15);
    cursor: pointer;
    transition: all 0.3s ease;
    opacity: 0.7;
  }

  .testimonial-nav-arrow:hover {
    opacity: 1;
    background: oklch(var(--accent-bg) / 0.2);
    transform: translateY(-50%) scale(1.05);
    box-shadow: 0 0 15px oklch(var(--accent-text) / 0.3);
  }

  .testimonial-nav-prev {
    left: 0;
  }

  .testimonial-nav-next {
    right: 0;
  }

  @media (max-width: 768px) {
    .testimonial-nav-arrow {
      width: 2.5rem;
      height: 2.5rem;
    }
  }

  /* Animation for testimonial items */
  @keyframes fadeInUp {
    from {
      opacity: 0;
      transform: translateY(20px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  @keyframes fadeOutDown {
    from {
      opacity: 1;
      transform: translateY(0);
    }
    to {
      opacity: 0;
      transform: translateY(-20px);
    }
  }

  .testimonial-item.entering {
    animation: fadeInUp 0.5s forwards;
  }

  .testimonial-item.leaving {
    animation: fadeOutDown 0.5s forwards;
  }
</style>

<script>
  // Client-side JavaScript for carousel functionality
  document.addEventListener("DOMContentLoaded", setupCarousel);
  document.addEventListener("astro:page-load", setupCarousel);

  function setupCarousel() {
    const items = document.querySelectorAll(".testimonial-item");
    const dots = document.querySelectorAll(".testimonial-dot");
    const prevBtn = document.querySelector(".testimonial-nav-prev");
    const nextBtn = document.querySelector(".testimonial-nav-next");

    let currentIndex = 0;
    let interval: any;
    const intervalTime = 5000; // 5 seconds
    const intervalTimeWithUserInteraction = 10000; // 10 seconds

    function showTestimonial(index: number) {
      // Remove active class from all items and dots
      items.forEach((item) => {
        if (item.classList.contains("active")) {
          item.classList.add("leaving");
          setTimeout(() => {
            item.classList.remove("active", "leaving");
          }, 500);
        }
      });

      dots.forEach((dot) => dot.classList.remove("active"));

      // Add active class to current item and dot
      setTimeout(() => {
        items[index].classList.add("active", "entering");
        dots[index].classList.add("active");

        setTimeout(() => {
          items[index].classList.remove("entering");
        }, 500);
      }, 500);

      currentIndex = index;
    }

    function nextTestimonial() {
      const nextIndex = (currentIndex + 1) % items.length;
      showTestimonial(nextIndex);
    }

    function prevTestimonial() {
      const prevIndex = (currentIndex - 1 + items.length) % items.length;
      showTestimonial(prevIndex);
    }

    function startAutoplay() {
      // Clear any existing interval first
      clearInterval(interval);
      interval = setInterval(nextTestimonial, intervalTime);
    }

    function stopAutoplay() {
      clearInterval(interval);
    }

    // Add click event listeners to dots
    dots.forEach((dot, index) => {
      dot.addEventListener("click", () => {
        stopAutoplay();
        showTestimonial(index);
        setTimeout(startAutoplay, intervalTimeWithUserInteraction);
      });
    });

    // Add click event listeners to navigation arrows
    if (prevBtn) {
      prevBtn.addEventListener("click", () => {
        stopAutoplay();
        prevTestimonial();
        setTimeout(startAutoplay, intervalTimeWithUserInteraction);
      });
    }

    if (nextBtn) {
      nextBtn.addEventListener("click", () => {
        stopAutoplay();
        nextTestimonial();
        setTimeout(startAutoplay, intervalTimeWithUserInteraction);
      });
    }

    // Start autoplay
    startAutoplay();

    // Add event listeners to pause autoplay when hovering over the carousel
    const carousel = document.querySelector(".testimonial-container");
    if (carousel) {
      carousel.addEventListener("mouseenter", stopAutoplay);
      carousel.addEventListener("mouseleave", startAutoplay);
    }
  }
</script>
